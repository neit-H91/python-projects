{% extends 'base.html' %}
{% block title %}Client Detail{% endblock %}
{% block extra_styles %}
.client-card { background-color: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #ddd; }
.section { background-color: white; padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #eee; }
{% endblock %}
{% block content %}

    {% if error %}
        <h1>{{ error }}</h1>
    {% else %}
        <div style="margin-bottom: 20px;">
            <a href="{% url 'owner_list' %}" class="btn-back">← Back to Clients</a>
            <a href="{% url 'dashboard' %}" style="margin-left: 10px;" class="btn-back">← Back to Dashboard</a>
        </div>

        <div class="client-card">
            <h1>{{ owner.first_name }} {{ owner.last_name }}</h1>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <p><strong>Email:</strong> {% if owner.email %}{{ owner.email }}{% else %}N/A{% endif %}</p>
                    <p><strong>Phone:</strong> {% if owner.phone %}{{ owner.phone }}{% else %}N/A{% endif %}</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Pets Owned</h2>
            {% if owner_animals %}
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Species</th>
                        <th>Birth Date</th>
                        <th>Action</th>
                    </tr>
                    {% for animal in owner_animals %}
                    <tr>
                        <td>{{ animal.name }}</td>
                        <td>{{ animal.specie.name }}</td>
                        <td>{{ animal.birth_date|date:"M j, Y" }}</td>
                        <td><a href="{% url 'animal_detail' animal.pk %}" target="_blank" class="action-btn">View Details</a></td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p class="no-data">{{ owner.first_name }} doesn't own any pets yet.</p>
            {% endif %}
        </div>

        <div class="section">
            <h2>Appointment History</h2>
            <div style="margin-bottom: 15px;">
                <a href="/admin/animal/appointment/add/?owner={{ owner.pk }}" class="btn-back" style="background-color: #4caf50;">+ Schedule New Appointment</a>
            </div>
            {% if owner_appointments %}
                <table>
                    <tr>
                        <th>Date & Time</th>
                        <th>Animal</th>
                        <th>Reason</th>
                        <th>Status</th>
                    </tr>
                    {% for appointment in owner_appointments %}
                    <tr>
                        <td>{{ appointment.date_time|date:"M j, Y H:i" }}</td>
                        <td>{{ appointment.animal.name }}</td>
                        <td>{{ appointment.reason }}</td>
                        <td>
                            {% if appointment.date_time|date:'Y-m-d' < 'now'|date:'Y-m-d' %}
                                Completed
                            {% elif appointment.date_time|date:'Y-m-d' == 'now'|date:'Y-m-d' %}
                                Today
                            {% else %}
                                Upcoming
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p class="no-data">{{ owner.first_name }} has no appointments scheduled.</p>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
